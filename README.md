# Алгоритмы в линейной алгебре

:::{seealso}
Алгоритмы по темам до билинейных форм на векторном пространстве включительно можно найти в [легендарном файлике](https://drive.google.com/file/d/1C8GIcpB-3iguJN4ZpqcpgYPyv-tnfkfb/view?usp=drive_link). Но, поскольку на билинейных формах гайды заканчиваются, было решено продолжить сие благородное дело и взять его в свои руки. **Итак, продолжение алгоритмов в линейной алгебре.**
:::

(algorithm1)=
## 1. Построение матрицы квадратичной формы

**Дано:** квадратичная форма вида $a_{11}x_1^2 + a_{12}x_1x_2 ... + a_{nn}x_n^2$

Требуется построить по ней матрицу квадратичной формы.

### Решение

1. **Заполняем главную диагональ:**
   Коэффициент $a_{ii}$ перед соответствующим элеметом $x_i^2$ записываем на место $i$-й строки $i$-го столбца.

$$\begin {pmatrix}
a_{11} &  & \\
 & a_{22} &  & \\
 &  & \ddots & \\
 &  &  & a_{nn}
\end{pmatrix}$$

2. **Остальные элементы:**
   Коэффициент перед $x_{ij}$ делим на $2$ и записываем в $i$-ю строку, $j$-й столбец и в $j$-ю строку, $i$-й столбец. Если для какого-то $i$ или $j$ элемента $a_{ij} x_{ij}$ нет в записи квадратичной формы, просто ставим на соответствующую позицию 0.

$$\begin {pmatrix}
a_{11} & \frac{a_{12}}{2} & \cdots & \frac{a_{1n}}{2}\\
a_{21} & a_{22} & \cdots & \frac{a_{2n}}{2}\\
\vdots & \vdots & \ddots & \vdots\\
\frac{a_{n1}}{2} & \frac{a_{n2}}{2} & \cdots & a_{nn}
\end{pmatrix}$$

:::{warning} Важно! 
Матрица должна выйти симметричной: коэффициент при $x_{ij}$ равен коэффициенту при $x_{ji}$.
:::

:::{prf:example}

Дана квадратичная форма $x_1^2 + 2x_1x_3 + 6x_2^2 + x_2x_3$. Необходимо построить её матрицу.

**Решение.** 
1. В результате должна получиться симметричная квавдратная матрица размера 3 на 3. Коэффициент перед $x_1^2 = 1$, перед $x_2^2 = 6$, перед $x_3^2 = 0$. Это элементы главной диагонали.
   
2. Коэффициент перед $x_1x_2 = 0$ — значит, в первой строке втором столбце и во второй строке в первом столбце стоят нули. Коэффициент перед $x_1x_3 = 2$ — тогда в первую строку третий столбец и в третью строку, первый столбец ставим $2/2 = 1$ (не забываем делить на 2).
Так же заполним всю матрицу: получим:

$$\begin {pmatrix}
1 & 0 & 1\\
0 & 6 & 0.5\\
1 & 0.5 & 0\\
\end{pmatrix}$$

:::

(algorithm2)=
## 2. Восстановление квадратичной формы по матрице

1. Элементы в $i$-й строке $i$-м столбце (на главной диагонали) будут коэффициентацми перед соотвествующими $x_i^2$.
2. Элементы на $i$-м $j$-м месте умножаем на $2$. Они будут коэффициентами перед $x_{ij}$, где $i \neq j$.

:::{warning} Важно!
Если мы выписали коэффициенты перед $x_{ij}$, то коэффициент перед $x_{ji}$ выписывать не нужно: они уже были учтены умножением на $2$.
:::

:::{prf:example}

Дана матрица квадратичной формы. По ней необходимо восстановить саму форму:

$$\begin {pmatrix}
2 & 4 & 2.5\\
4 & 0 & 0\\
2.5 & 0 & 3\\
\end{pmatrix}$$

**Решение.** 

1. Коэффициенты перед $x_2x_3$ и перед $x_3^2$ будут равны 0;

2. Коэффициент перед $x_1^2 = 2$, а перед $x_3^2 = 3$.

3. Коэффициент перед $x_1x_2$ равен $4 \times 2 = 8$ — при этом коэффициент перед $x_2x_1$ считать и выписывать уже не нужно. Аналогично, коэффициент перед $x_1x_3$ равен $2.5 \times 2 = 5$.

Собираем всё найденное в квадратичную форму, которой соответствует матрица: получается $2x_1^2 + 2x_1x_2 + 5x_1x_3 + 3x_3^2$

:::

(algorithm3)=
## 3. Знакоопределённость квадратичной формы

1. Находим матрицу квадратичной формы.
2. Находим все угловые миноры $\delta_1,\delta_2,\dots,\delta_n$.

#### Что такое угловые миноры и как их посчитать?

В матрице

$$\begin {pmatrix}
a_{11} & a_{12} & \cdots & \frac{a_{1n}}{2}\\
a_{22} & a_{22} & \cdots & a_{2n} \\
\vdots & \vdots & \ddots & \vdots\\
a_{n1} & \cdots & \cdots & a_{nn}
\end{pmatrix}$$

$$\delta_1 = \det (a_{11}) = a_{11}, \quad \delta_2 = \det \begin{pmatrix}
    a_{11} & a_{12}\\
    a_{12} & a_{22}
\end{pmatrix},\quad \delta_3 = \det \begin {pmatrix}
a_{11} & a_{12} & a_{13}\\
a_{21} & a_{22} & a_{23}\\
a_{31} & a_{32} & a_{33}\\
\end{pmatrix}$$

...и так далее — соответственно, последним угловым минором $\delta_n$ будет определитель всей матрицы.

3. Определяем знакоопределённость квадратичной формы:
   * Если $\forall i\colon 1\leqslant i \leqslant n$ все $\delta_i>0$, то квадратичная форма положительно определена.
   * Если знаки миноров чередуются и первый угловой минор положителен: то есть, если $\delta_1 < 0, \delta_2 > 0, \delta_3 < 0$, квадратичная форма отрицательно определена.
   * В иных случаях про знакоопределённость квадратичной формы ничего сказать нельзя.

(algorithm4)=
## 4. Приведение квадратичной формы к нормальному виду

**Дано:** квадратичная форма вида $a_{11}x_1^2 + a_{12}x_1x_2 ... + a_{nn}x_n^2$. Необходимо привести её или к нормальному виду, или к каноническому виду. 

:::{warning}
**Нормальный вид единственен** (с точностью до перестановки координат) — только квадраты переменных входят в квадратичную форму и коэффициенты строго равны $\plusmn 1$ или 0. 

```{prf:example} Нормальный вид
$$x_1^2-x_2^2+x_4^2-x_5^2$$
```

**Канонических видов много**, по сути каноническим является любой вид, куда входят только квадраты, чьи коэффициенты могут быть любыми. Иногда, если все коэффициенты Якоби, кроме быть может последнего, ненулевые, **каноническим называют вид, в котором коэффициенты перед квадратами получены из метода Якоби.**

```{prf:example} Канонический вид
$$16x_1^2-9x_2^2+10x_4^2-x_5^2$$
```
:::

### Метод Якоби, или метод угловых миноров:

1. Ищем [матрицу квадратичной формы](#algorithm1).
2. Ищем [угловые миноры](#algorithm3) $\delta_1,\delta_2,\dots,\delta_n$
3. Ищем коэффициенты:
   * $\delta_1$ — это коэффициент перед $x_1^2$;
   * $\displaystyle\frac{\delta_2}{\delta_1}$ - коэффициент перед $x_2^2$;
   * ...и так далее: коэффициентом перед $x_n^2$ будет $\displaystyle\frac{\delta_n}{\delta_{n - 1}}$
  
:::{warning} Важно!
Метод Якоби применим лишь в тех случаях, когда все угловые миноры, кроме $n$-го, строго больше или меньше 0 — не то в знаменателях окажутся нули. Последний, $n$-й минор, или определитель всей матрицы, может быть равен чему угодно.
:::

Получив коэффициенты перед всеми $x_i^2$, можем выписать нормальный вид квадратичной формы, который должен выглядеть так: 

$$\delta_1x_1^2+\frac{\delta_2}{\delta_1}x_2^2+\frac{\delta_3}{\delta_2}x_3^2+\dots+\frac{\delta_n}{\delta_{n-1}}x_n^2$$

### Симметричный метод Гаусса

Главное правило: если мы выполняем какую-то операцию с $i$ и $j$ строкой (или умножаем на $\lambda$ $i$-ю строку), то следующим шагом мы должны сделать то же самое с $i$ и $j$ столбцом (соответственно, с $i$-м столбцом).

:::{prf:example}
$$\begin{pmatrix}
    1 & 4\\
    4 & 6
\end{pmatrix}\mapsto\begin{pmatrix}
    1 & 4\\
    0 & -10
\end{pmatrix}\mapsto\begin{pmatrix}
    1 & 0\\
    0 & -10
\end{pmatrix}$$

1. Прибавляем ко второй строке первую, умноженную на $-4$.
2. Прибавляем ко второму столбцу 1-й, умноженный на $-4$.
3. Ура, матрица теперь диагональна.
:::

:::{prf:example} Все диагональные элементы равны 0
$$\begin{pmatrix}
    0 & 4\\
    4 & 0
\end{pmatrix}\mapsto\begin{pmatrix}
    2 & 4\\
    4 & 0
\end{pmatrix}\mapsto\begin{pmatrix}
    4 & 4\\
    4 & 0
\end{pmatrix}\mapsto\begin{pmatrix}
    4 & 4\\
    0 & -4
\end{pmatrix}\mapsto\begin{pmatrix}
    4 & 0\\
    0 & -4
\end{pmatrix}$$

1. Прибавляем к первой строке вторую, умноженную на $0.5$.
2. Прибавляем к первому столбцу второй, умноженный на $0.5$.
3. Прибавляем ко второй строке первую, умноженную на $-1$.
4. Прибавляем ко второму столбцу 1-й, умноженный на $-1$.
5. Ура, матрица теперь диагональна.
:::

Таким образом, если у нас есть матрица квадратичной формы $Q$, можем привести её к диагональному виду, получив матрицу $Q'$ и коэффициенты для всех $x_i^2$ - в точности соответствующие элементы главной диагонали.

Тогда канонический вид квадратичной формы будет выглядеть так:
$$q_{11}x_1^2 + q_{22}x_2^2 +... + q_{nn}x_n^2$$
где $q_{ii}$ - элемент $i$ строки $i$ столбца полученной нами диагональной матрицы $Q'$

(algorithm5)=
## 5. Нахождение матрицы перехода к системе координат, в которых квадратичная форма имеет канонический вид

1. Пусть $Q$ – квадратичная форма. [Найдём её матрицу](#algorithm1) $A$
2. Запишем матрицу $B$, столбцами которой будут векторы, составляющие базис, в координатах которого записан исходный вид квадратичной формы.
3. Запишем расширенную матрицу следующим образом:

$$\begin{pmatrix}
   A \bigm | B
\end{pmatrix}$$

4. Приведём матрицу $\begin{pmatrix}
   A \bigm | B
\end{pmatrix}$ к диагональному виду, используя симметричный метод Гаусса.

:::{warning} Важно
Элементарные преобразования строк **касаются** и матрицы $C$. А вот преобразования столбцов – нет! Вот пример того, как это делается:
:::

:::{prf:example}

Положим, $A = \begin {pmatrix}
1 & 4\\
4 & 6 
\end{pmatrix}
$, а в столбцы матрицы $E$ записаны векторы стандартного базиса в $\mathbb{R^2}$. Тогда $A \mid E = \begin {pmatrix}
1 & 4 & \bigm| & 1 & 0\\
4 & 6 & \bigm| & 0 & 1
\end{pmatrix}$

Ко **всей** второй строке прибавляем первую, умноженную на (-4) $\implies$ получаем $\begin {pmatrix}
1 & 4 & \bigm| & 1 & 0\\
0 & -10 & \bigm| & -4 & 1
\end{pmatrix}\implies$ теперь, поскольку алгоритм - симметричный, ко второму столбцу должны прибавить первый, умноженный на (-4). Однако эту операцию проделываем уже только для матрицы $A \implies$ $\begin {pmatrix}
1 & 0 & \bigm| & 1 & 0\\
0 & -10 & \bigm| & -4 & 1
\end{pmatrix}$
Заметим, матрица справа никак не меняется после преобразования столбцов!
:::

5. Столбцы матрицы, оставшейся справа после приведения расширенной матрицы к диагональному виду - это и есть векторы базиса, в котором квадратичная форма принимает канонический вид. А полученная нами диагональная матрица - в точности матрица квадратичной формы, принимающей в найденном нами базисе нормальный вид.

## 6. Ортогонализация базиса

Дан базис $e\colon (e_1, e_2, \dots, e_n)$. Необходимо сделать из него ортогональный базис $(f_1, f_2, \dots, f_n)$.

### Решение.

Положим, $e_1 = f_1$. Остальные векторы $f_i$ будем достраивать по следующей формуле:
$$f_{k + 1} = e_{k + 1} - \sum_{i = 1}^{k}{\lambda _if_i},$$

где $\lambda_i = \frac{(e_{k + 1}, f_i)}{(f_i, f_i)}$ и $(v, w)$ - скалярное произведение любых двух векторов $v$ и $w$.

К примеру, $f_{2} = e_2 - \frac{(e_2, f_1)}{(f_1, f_1)}f_1$

## 7. Проверка матрицы Грама на предмет соответствия системе векторов

Дана матрица $A  \in M_2(\mathbb{R})$. Необоходимо узнать, является ли она матрицей Грама какой-нибудь из систем векторов, и, если да — предъявить эту систему.

1. Проверим матрицу на симметричность: $\forall x_{ij}\colon x_{ij} = x_{ji}$. Если матрица не симметрична, ответ на поставенный в задаче вопрос — "нет".
2. Используя симметричный метод Гаусса (см. алгоритм 5), приведём расширенную матрицу $A\mid E$ к диагональному виду $D\mid B$, где $D$ - диагональная матрица, $B$ — результат преобразований матрицы $E$.

:::{warning} **Важно**
Операции, выполняемые со столбцами, выполняем только для матрицы $A$! [Здесь есть пример](#algorithm5) того, как это делается.
:::

3. Матрица $B$ — транспонированная матрица $C$, иными словами, $B = C^T$
4. Обозначим элементы, стоящие на $ii$-м месте в получившейся диагональной матрице $D$, как $d_i$. Найдём векторы нового базиса по формуле $f_i = \sqrt{d_i}e_i$, где $e_i$ — векторы стандартного базиса.
5. Найдём искомую систему векторов по формуле 
   $$(v_1, v_2 ... v_n) = (f_1, f_2 ... f_n)C^{-1}$$


## 8. Вычисление ортогональной проекции вектора.

### Способ 1
 **Условие:** дан вектор $v$ и ортогональный базис $e$ в подпространствe $S$. Важно: базис именно ортогональный - в противном случае нужно привести его к виду ортогонального, воспользовавшись алгоритмом 6, если мы хотим использовать именно первый способ.

**Найти:** ортогональную проекцию вектора $v$ на $S$.

### Решение

Посчитаем проекцию по формуле:

$$\text{pr}_S v = \sum_{i = 1}^{k}{\frac{(v, e_i)}{(e_i, e_i)}} e_i$$

### Способ 2

**Условие:** дан вектор $v$ в пространстве $\mathbb{E} = \mathbb{R^n}$ со стандартным скалярным произведением и *любой* базис $F$ в подпространствe $S$.

**Найти:** ортогональную проекцию вектора $v$ на $S$.

### Решение.

1. Запишем базисные векторы $f_1, ... f_n$ в столбцы матрицы — получим матрицу $A$.
2. Вычислим ортогональную проекцию по формуле:
$$pr_S v = A(A^TA)^{-1}A^T v$$

## 9. Переопределение системы уравнений.

Дана система линейных уравнений $Ax = b$ $(A \in M_{m*n}; m > n)$ , не имеющая решения. Необходимо найти *псевдорешение* так называемой *переопределённой системы уравнений*.

### Решение.

Воспользуемся формулой $x = (A^T A)^{-1}A^Tb$. Полученный вектор $x$ — и есть нужное нам *псевдорешение*.

## 10. Поиск векторного произведения в $\mathbb{R^3}$

Даны два вектора $a$, $b \in \mathbb{R}^3$ и базис $e$ в $\mathbb{R}^3$. Найти векторное произведение $[a, b]$ в базисе $e$.

### Решение.

1. Составим матрицу $A_i$, записав в первый столбец координаты вектора $a = (a_1, a_2, a_3)$, во второй — координаты вектора $b = (b_1, b_2, b_3)$, а в третий - координаты базисного вектора $e_i = (e_{i1}, e_{i2}, e_{i3})$:

$$\begin {pmatrix}
a_1 & b_1 & e_{i1}\\
a_2 & b_2 & e_{i2}\\
a_3 & b_3 & e_{i3}\\
\end{pmatrix}$$

2. Определитель $\det A_i$ - это $i$-я координата вектора $c = [a, b]$. Таким образом посчитаем все координаты, найдя определители всех возможных матриц $A_i$.

**Например,** для нахождения первой координаты найдём определитель матрицы $A_1$, в первый столбец которой записаны координаты вектора $a$, во второй — координаты вектора $b$, а в третий — координаты базисного вектора $e_1$.

**Явная формула:** $\det\begin {pmatrix}
a_2 & a_3\\
b_2 & b_3\\
\end{pmatrix}e_1 + \det\begin {pmatrix}
a_3 & a_1\\
b_3 & b_1\\
\end{pmatrix}e_2 + \det\begin {pmatrix}
a_1 & a_2\\
b_1 & b_2\\
\end{pmatrix}e_3$

## 11. Нахождение вектора по заданным ортогональным проекциям и ортогональным составляющим.

Дано: в пространстве $\mathbb{R}^n$ два подпространства $U$ и $W$, ортогональная проекция $\pr_U v$ вектора $v$ на $U$ и ортогональная составляющая $\ort_W v$ вектора $v$ на $W$, а также базисы $U$ и $V$. Требуется найти вектор $v$.

**Решение.** 
   1.  Если $\dim(U) = k$, а базис $U$ - векторы $u_1, u_2 ... u_k,$ то базис $U^\perp$ - векторы $u_{k + 1}, ... u_n$. Аналогично, если $\dim(W) = l$, а базис $W$ - векторы $w_1, w_2 ... w_l,$ то базис $W^\perp$ - векторы $u_{l + 1}, ... u_n$.
   
   2.  Найдём базис $U^\perp$: если $U =$ $\langle u_1, ... u_k\rangle$ - иными словами, если $U$ задано как линейная оболочка векторов $u_1, ... u_k$, выписываем координаты этих векторов в строки: это коэффициенты перед неизвестными в ОСЛУ:
   $$u_{11}x_1 + u_{12}x_2 + ... u_{1n} x_n = 0\\ \vdots \\ u_{k1}x_{1} + u_{k2}x_2 + ... u_{kn} x_{n} = 0$$

   Тогда ФСР этой системы и будет базисом $U^\perp$.
   Ecли $U$ задано, как пространство решений ОСЛУ, то строки матрицы коэффициентов этой ОСЛУ - и есть те самые базисные векторы.

   Предположим, $U$ задано, как пространство решений системы:
   $$u_{11}x_1 + u_{12}x_2 + ... u_n x_n = 0\\ \vdots \\ u_{k1}x_{1} + u_{k2}x_2 + ... u_{kn} x_{n} = 0$$

   Тогда $u_1 = u_{11}, u_{12}, ... u_{1n}$ - первый базисный вектор, $u_2 = u_{21}, u_{22}, ... u_{2n}$ - второй - и так далее.
   
   3.  Можем единственным образом выразить вектор $v$ в виде: 
   
   $\pr_U v + \ort_U v = \pr_U v + \underbrace{a_{k + 1} u_{k + 1} + ... + a_n u_n}_{\ort_U v}$, где $a_{k + 1}, ... a_n$ - какие-то координаты перед векторами $u_{k + 1}, ... u_n$, и единственным образом - в виде: $\pr_W v + \ort_W v = \underbrace {b_1 w_i + ... + b_l u_l}_{\pr_W v} + \ort_W v$, где $b_1, ... b_n$ - координаты перед соответствущими векторами $w_1, ... w_l$.
   Значит, $v = \pr_U v + a_{k + 1} u_{k + 1} + ... + a_n u_n = b_1 w_i + ... + b_l u_l + \ort_W v$

   4. Векторы $\pr_U v$ и $\ort_U w$ даны по условию. Перегпуппируем слагаемые и получим систему линейных уравнений с неизвестными $a_{k + 1},\dots a_n, b_1,\dots b_l$
   $$a_{k + 1} u_{k + 1} + ... + a_n u_n + b_1 w_i + ... + b_l u_l = -\pr_U v + \ort_W v$$
   
   Решим эту СЛУ и получим вектор $(a_{k + 1},$ $...$ $a_n, b_1,$ $...$ $b_l)$

   Подставим найденные координаты в любую из формул: $\pr_U v + \underbrace {a_{k + 1} u_{k + 1} + ... + a_n u_n}_{\ort_U v}$ или $\underbrace {b_1 w_i + ... + b_l u_l}_{\pr_W v} + \ort_W v$ - все элементы нам теперь известны - и найдём ответ.

### 12. Нахождение объёма параллелепипеда, натянутого на систему векторов $(u_1, u_2$ ... $u_k)$, если известен объём параллелепипеда, натянутого на систему векторов $(v_1, v_2$ $...$ $v_k)$

1. Запишем в столбцы матрицы $V$ векторы $(v_1, v_2$ $...$ $v_k)$ и в столбцы матрицы $U$ - векторы $(u_1, u_2$ ... $u_k)$.
Теперь найдём такую матрицу $C$, что $VC = U$.
2. Знаем формулу: $\Vol P (v_1, v_2$ $...$ $v_k) = \sqrt{\det G(v_1, v_2 ... v_k)}$

    Знаем также: $G(u_1, u_2$ ... $u_k) = C^TG(v_1, v_2$ $...$ $v_k)C$

   Значит, $\Vol P (v_1, v_2$ $...$ $v_k) = \sqrt{\det C^TG(v_1, v_2 ... v_k)C} =$ (матрица $C$ - квадратная) = $\sqrt{\det C^T\det G(v_1, v_2 ... v_k)\det C} = \underbrace{|\det C|}_{\det C = \det C^T}\underbrace{\sqrt{\det G(v_1, v_2 ... v_k)}}_{\Vol P (v_1, v_2 ... v_k)}$

   Посчитаем значение определителя матрицы $C$ и, поскольку $\Vol P (v_1, v_2 ... v_k)$ нам известен по условию, подставим имеющиеся у нас значения и получим ответ.

